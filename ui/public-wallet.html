<!DOCTYPE html>
<html>
<body id="body">
  <div id="operationStatus">LOADING</div>
  <div id="noKeyPage" style="text-align:center">
    <div>
      <h1>SenShaMart</h1>
    </div>
    <div>
      <h3>A Global Network For Sharing IoT Sensors</h3> 
    </div>
    <hr />
    <div>
      <span>Please enter your keyPair:</span>
    </div>
    <div>
      <input id="noKeyKeyPair" style="width:100%;text-align:center"/>
    </div>
    <div>
      Or
    </div>
    <div>
      <input id="noKeyKeyUpload" type="file" />
    </div>
    <div>
      Or
    </div>
    <div>
      <button id="noKeyGenKeyGo">Generate a New Key</button>
    </div>
    <hr />
    <div>
      What do you want to do:
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr">
      <button id="noKeyBrokerGo" style="display:none"><h3>SenShaMart Broker</h3> <br /> You provide MQTT brokers for Senshamart to help sensors share their data, and get paid doing so</button>
      <button id="noKeyProviderGo"><h3>Sensor Provider</h3> <br /> You register and share your IoT sensors, and get paid by applications using your data</button>
      <button id="noKeyApplicationGo"><h3>Sensor Client</h3> <br /> You find, use, and pay for data from available third party sensors</button>
    </div>
    <hr/>
    <div>
      Or:
    </div>
    <div style="display:grid; grid-template-columns:1fr 1fr 1fr">
      <span></span>
      <button id="noKeyExpertGo"><h4>Developer</h4> <br />  You are a power user or developer. You have more powerful but more complicated tools</button>
      <span></span>
    </div>
  </div>
  <div id="keyPage" style="display:none;">
    <div id="refreshStatus" style="display:none">LOADING</div>
    <hr />
    <div style="display:flex">
      <span>Your public key: </span>
      <input id="publicKey" disabled value="LOADING" style="flex-grow:1;"/>
      <button id="changeMode">Change role</button>
    </div>
    <div id="keyPairSetDiv" style="display:none">
      <span>Wallet keypair: </span><input id="privateKey" style="flex-grow:1;"/>
    </div>
    <div>
      <span>Current wallet balance: </span><span id="coinCount">0</span>
    </div>
    <div id="chainDepthDiv" style="display:none">
      <span>Current chain length: </span><span id="chainDepth">LOADING</span>
    </div>
    <hr />
    <div style="display:flex">
      <button id="genKeyButton">Generate Key</button>
      <button id="yourBrokersButton">Your Registered Brokers</button>
      <button id="registerBrokerButton">Register a Broker</button>
      <button id="allBrokersButton">All Brokers</button>
      <button id="registerSensorButton">Register a Sensor</button>
      <button id="sensorsButton">Your Registered Sensors</button>
      <button id="integrationUsesOurSensorsButton">Current Integrations With Your Sensors</button>
      <button id="freeformQueryButton">Query Sensors</button>
      <button id="integrateButton">Integrate With Sensors</button>
      <button id="integrationsButton">Current Integrations By You</button>
    </div>
    <hr />
    <div id="genKeyTab">
      <div>
        <button id="genKeyGo">Generate New Key Pair</button>
      </div>
      <div>
        <span>Key Pair:</span>
      </div>
      <div>
        <textarea id="genKeyKeyPair" readonly style="resize:both"></textarea>
      </div>
    </div>
    <div id="registerBrokerTab">
      <div style="display:grid; grid-template-columns: auto 1fr">
        <span>Name:</span><input id="registerBrokerName" required />
        <span>Endpoint:</span><input id="registerBrokerEndpoint" required />
        <span>Extra metadata:</span><span><button id="registerBrokerClearMetadata">Clear</button><input id="registerBrokerMetadata" type="file" value="" /></span>
        <span>Reward amount:</span><input id="registerBrokerReward" type="number" min="0" value="0" required />
        <button id="registerBrokerGo">Create</button>
      </div>
      <div id="registerBrokerResultDiv" style="display:none">
        <h1>
          Raw Broker Registration Transaction:
        </h1>
        <label id="registerBrokerResult"></label>
      </div>
    </div>
    <div id="registerSensorTab">
      <div style="display:grid; grid-template-columns: auto 1fr">
        <span>Name:</span><input id="registerSensorName" required />
        <span>Cost Per Minute:</span><input id="registerSensorCPM" type="number" min="0" value="1" required />
        <span>Cost Per KB:</span><input id="registerSensorCPKB" type="number" min="0" value="1" required />
        <span id="registerSensorBrokerInfo">Broker:</span><select id="registerSensorBroker" required></select>
        <span id="registerSensorMetadataInfo">Extra metadata:</span><span id="registerSensorMetadataData"><button id="registerSensorClearMetadata">Clear</button><input id="registerSensorMetadata" type="file" value="" /></span>
        <span id="registerSensorLatitudeInfo">Latitude:</span><input id="registerSensorLatitude" type="number" min="-90" max="90" value="0"/>
        <span id="registerSensorLongitudeInfo">Longitude:</span><input id="registerSensorLongitude" type="number" min="-180" max="180" value="0"/>
        <span id="registerSensorMeasuresInfo">Measures:</span><input id="registerSensorMeasures" />
        <span style="display:none">Measurement Interval:</span><span style="display:none"><button id="registerSensorUnknownInterval">Set to not periodic</button><input id="registerSensorInterval" type="number" min="0" value="1000"/><span id="registerSensorIntervalFooter">ms</span></span>
        <span>Reward amount:</span><input id="registerSensorReward" type="number" min="0" value="0" required />
        <button id="registerSensorGo">Create</button>
      </div>
      <div id="registerSensorConnectionDiv" style="display:none; grid-template-columns: auto 1fr auto 1fr">
        <div>Connection address:</div>
        <div id="registerSensorConnectionAddress"></div>
        <div>Connection topic:</div>
        <div id="registerSensorConnectionTopic"></div>
      </div>
      <div id="registerSensorResultDiv" style="display:none">
        <h1>
          Raw Sensor Registration Transaction:
        </h1>
        <label id="registerSensorResult"></label>
      </div>
    </div>
    <div id="integrationUsesOurSensorsTab" style="display:grid; grid-template-columns: 1fr 7fr;">
      <div style="border: 1px">
        <div>
          Integrations:
        </div>
        <div>
          <div>
            <select id="integrationUsesOurSensorsIntegrations" style="width:100%" size="10">
            </select>
          </div>
        </div>
      </div>
      <div id="integrationUsesOurSensorsInfo" style="display:none">
        <div style="display: grid; grid-template-columns: auto 1fr">
          <span>Started: </span>
          <input id="integrationUsesOurSensorsInfoStarted" disabled />
          <span>Hash: </span>
          <input id="integrationUsesOurSensorsInfoHash" disabled />
          <span>Witness Count: </span>
          <input id="integrationUsesOurSensorsInfoWitnessCount" disabled />
        </div>
        <div>Sensors</div>
        <div style="height:25vh;overflow:hidden;overflow-y:scroll">
          <table style="border-collapse: collapse; width:100%; table-layout:fixed">
            <thead style="top:0;position:sticky;background-color:white;z-index:2">
              <tr>
                <th>Sensor Name</th>
                <th>Amount</th>
                <th>Cost per KB</th>
                <th>Cost per Minute</th>
                <th>Broker</th>
              </tr>
            </thead>
            <tbody id="integrationUsesOurSensorsOutputBody"></tbody>
          </table>
        </div>
        <div>Witnesses</div>
        <div style="height:25vh;overflow:hidden;overflow-y:scroll">
          <table style="border-collapse: collapse; width:100%; table-layout:fixed">
            <thead style="top:0;position:sticky;background-color:white;z-index:2">
              <tr>
                <th>Broker Name</th>
              </tr>
            </thead>
            <tbody id="integrationUsesOurSensorsWitnessesBody"></tbody>
          </table>
        </div>
      </div>
    </div>
    <div id="freeformQueryTab">
      <div>Query:</div>
      <select id="freeformSelect" style="width:100%"></select>
      <div>
        <textarea id="freeformQueryInput" style="width:100%;resize:vertical" spellcheck="false"></textarea>
      </div>
      <div>
        <button id="freeformGo">Go!</button>
      </div>
      <div>
        <table style="border-collapse: collapse">
          <thead id="freeformHead"></thead>
          <tbody id="freeformBody"></tbody>
        </table>
      </div>
    </div>
    <div id="integrateTab">
      <div>
        <div>Query:</div>
        <select id="integrateFreeformSelect" style="width:100%"></select>
        <div>
          <textarea id="integrateFreeformQueryInput" style="width:100%;resize:vertical" spellcheck="false"></textarea>
        </div>
        <div>
          <button id="integrateFreeformGo">Go!</button>
        </div>
        <div>
          <button id="integrateFreeformAdd" disabled>Add Sensor Results To Selected Sensors</button>
        </div>
        <div>
          <table style="border-collapse: collapse">
            <thead id="integrateFreeformHead"></thead>
            <tbody id="integrateFreeformBody"></tbody>
          </table>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr">
        <div>
          <span>Selected Sensors: </span>
          <select id="integrateSensors" style="width:100%" size="10"></select>
        </div>
        <div id="integrateInfo" style="display:none">
          <div style="display:grid;grid-template-columns: auto 1fr">
            <span>Name: </span>
            <input id="integrateInfoName" disabled />
            <span>Cost Per Minute: </span>
            <input id="integrateInfoCPM" disabled />
            <span>Cost Per KB: </span>
            <input id="integrateInfoCPKB" disabled />
            <span>Broker: </span>
            <input id="integrateInfoBroker" disabled />
            <span id="integrateInfoAmountLabel">Amount: </span>
            <input id="integrateInfoAmount" type="number" min="1" value="1" />
          </div>
          <button style="width:100%" id="integrateDeselect">Deselect This Sensor</button>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:auto 1fr">
        <span>Reward Amount:</span>
        <input id="integrateReward" type="number" min="0" value="0" />
      </div>
      <button id="integrateGo">Pay And Integrate</button>
      <div>
        <h1>
          Connection Info:
        </h1>
        <table style="border-collapse: collapse; width: 100%; table-layout: fixed">
          <thead>
            <tr>
              <th>SensorName</th>
              <th>Broker ip</th>
              <th>MQTT topic</th>
            </tr>
          </thead>
          <tbody id="integrateConnectInfoBody"></tbody>
        </table>
      </div>
      <div id="integrateResultDiv" style="display:none">
        <h1>
          Raw Integration Transaction:
        </h1>
        <div id="integrateResult">

        </div>
      </div>
    </div>
    <div id="integrationsTab" style="display:grid; grid-template-columns: 1fr 7fr;">
      <div style="border: 1px">
        <div>
          Integrations:
        </div>
        <div>
          <div>
            <select id="integrationIntegrations" style="width:100%" size="10">
            </select>
          </div>
        </div>
      </div>
      <div id="integrationInfo" style="display:none">
        <div style="display: grid; grid-template-columns: auto 1fr">
          <span>Started: </span>
          <input id="integrationInfoStarted" disabled />
          <span>Hash: </span>
          <input id="integrationInfoHash" disabled />
          <span>Witness Count: </span>
          <input id="integrationInfoWitnessCount" disabled />
        </div>
        <div>Sensors</div>
        <div style="height:25vh;overflow:hidden;overflow-y:scroll">
          <table style="border-collapse: collapse; width:100%; table-layout:fixed">
            <thead style="top:0;position:sticky;background-color:white;z-index:2">
              <tr>
                <th>Sensor Name</th>
                <th>Amount</th>
                <th>Cost per KB</th>
                <th>Cost per Minute</th>
                <th>Broker</th>
              </tr>
            </thead>
            <tbody id="integrationOutputBody"></tbody>
          </table>
        </div>
        <!--<div>Witnesses</div>
        <div style="height:25vh;overflow:hidden;overflow-y:scroll">
          <table style="border-collapse: collapse; width:100%; table-layout:fixed">
            <thead style="top:0;position:sticky;background-color:white;z-index:2">
              <tr>
                <th>Broker Name</th>
              </tr>
            </thead>
            <tbody id="integrationWitnessesBody"></tbody>
          </table>
        </div>-->
      </div>
    </div>
  </div>
</body>
</html>

<script type="module">
  import startUI from './wallet.js';
  startUI();
</script>